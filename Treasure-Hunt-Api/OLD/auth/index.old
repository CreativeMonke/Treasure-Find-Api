import express from "express"
import bodyParser from "body-parser";
import { FindCursor, MongoClient } from "mongodb";

const port = 3001;

const uri = "mongodb+srv://rarescristiandarabana:c5UVekJirxJ4OTOU@users.uyojqiw.mongodb.net/?retryWrites=true&w=majority&appName=Users";
///Add user
const client = new MongoClient(uri);

async function CreateLocation(props)
{
    console.log("Sent!");
    try{
        const database = client.db("locations");
        const locations = database.collection("Locations");

        locations.insertOne(props);
    }
    finally{
        await client.close();
    }
}

async function findLocation(props)
{
    try{
        const database = client.db("locations");
        const locations = database.collection("Locations");
        
        return locations.findOne(props);
    }
    finally{
        await client.close();
    }
}

const app = express();
app.use(bodyParser.urlencoded({extended: true}));

app.post("/createLocation" ,(req,res) => {
    const {name,desc,lat,long} = req.body;
    console.log(req.body);
    const locationObj={
        name: name,
        desc : desc,
        lat:lat,
        long:long,
    }
    CreateLocation(locationObj).catch(console.dir);
    res.sendStatus(200);
});

app.get("/findLocation",(req,res) => {
    const {name} = req.query;
    const locationObj={
        name: name,
    }
    const desc = findLocation(locationObj);
    
    console.log(locationObj);
    res.send()
})

app.listen(port, () => {
    console.log(`Server is running on port ${port}`);
  });
